// ==UserScript==
// @name                Winex Devops(prod mode)
// @namespace           Winex
// @version             0.0.0
// @description         Winex运维平台
// @author              zhang333
// @match               https://127.0.0.1:7051/*
// @run-at              document-end
// @icon                https://weberp.winning.com.cn/favicon.ico
// @grant               unsafeWindow
// ==/UserScript==

!function(){"use strict";if("/cluster/action/index/welcome"===location.pathname){let e=function(e){$('<div class="win-cop-app"></div>').appendTo($(".win-cop-content")).html(`\n        <div class="win-cop-app-icon icon-${e.icon}"></div>\n        <div class="win-cop-app-text">${e.text}</div>\n    `).on("click",(function(){openApp(e)}))},a=setInterval((()=>{$(".win-cop-app .win-cop-app-text").get().find((e=>"制品管理"===e.innerText))?clearInterval(a):(e({icon:"product-manager",id:"610b0a86fe99458b8766c9156392fb0d",no:0,text:"制品管理",url:"/cluster/action/iframepage/initConfigPage?menuIds=610b0a86fe99458b8766c9156392fb0d"}),e({icon:"product-manager",id:"bde3ccbb9ef541e18856d1288305b199",no:0,text:"制品管理-补丁包管理",url:"/cluster/app/win/patchmgr"}))}),1e3)}if("/cluster/app/win/webclient"===location.pathname&&setInterval((()=>{try{unsafeWindow.pageUI.getViewPart("main").getComponent("toolbar").getButton("toolbar_toolbaritem_web").setActive(!0),unsafeWindow.pageUI.getViewPart("main").getComponent("toolbar").getButton("toolbar_toolbaritem_patch").setActive(!0)}catch(e){console.log(111,e)}}),1e3),"/cluster/action/iframepage/initConfigPage"===location.pathname){var e=[{appType:0,code:"productManager",cover_sync_flag:!0,icon:"product-manager",isvisible:!0,menuid:"610b0a86fe99458b8766c9156392fb0d",menuname:"制品管理",menupid:"2794c511326e408197a388e242e2dbdc",no:50,subMenuList:[{appType:2,cover_sync_flag:!0,icon:"jqbs",isvisible:!0,menuid:"5140022b35474d6cafaccb1763139404",menuname:"项目仓库",menupid:"610b0a86fe99458b8766c9156392fb0d",menuurl:"/cluster/app/win/projectmanager",no:0},{appType:2,cover_sync_flag:!0,icon:"jqbs",isvisible:!0,menuid:"0cbdcd65d1d74ac799b7253f917b54e1",menuname:"产品包管理",menupid:"610b0a86fe99458b8766c9156392fb0d",menuurl:"/cluster/app/win/products",no:4},{appType:2,cover_sync_flag:!0,icon:"jqbs",isvisible:!0,menuid:"bde3ccbb9ef541e18856d1288305b199",menuname:"补丁包管理",menupid:"610b0a86fe99458b8766c9156392fb0d",menuurl:"/cluster/app/win/patchmgr",no:5},{appType:2,cover_sync_flag:!0,icon:"jqbs",isvisible:!0,menuid:"bcb37aefa85f4400a0a19805b2c35aed",menuname:"数据库补丁",menupid:"610b0a86fe99458b8766c9156392fb0d",menuurl:"/cluster/app/win/dbpatch",no:6},{appType:2,cover_sync_flag:!0,icon:"productmanager",isvisible:!1,menuid:"c15f257caa034d1b8a43c47f0464e211",menuname:"制品管理（菜单体系的坑，这里地址要和app_config.json中的地址对应）",menupid:"610b0a86fe99458b8766c9156392fb0d",menuurl:"/cluster/action/iframepage/initConfigPage?menuIds=610b0a86fe99458b8766c9156392fb0d",no:7},{appType:2,cover_sync_flag:!0,icon:"jqbs",isvisible:!0,menuid:"9b051274e41844fcbdc3e5dc786782cc",menuname:"产品发布历史",menupid:"610b0a86fe99458b8766c9156392fb0d",menuurl:"/cluster/app/win/pubhistory",no:10},{appType:2,cover_sync_flag:!0,icon:"jqbs",isvisible:!0,menuid:"fddc4e9e88df458cb5f01f7e2ae617da",menuname:"发布计划管理",menupid:"610b0a86fe99458b8766c9156392fb0d",menuurl:"/cluster/app/win/releaseplan",no:11}],tags:"制品管理",title:"制品"}];let a=setInterval((()=>{if($("#nav_bde3ccbb9ef541e18856d1288305b199")[0])clearInterval(a);else try{let a=function(){$(".nav").empty();for(var a=0;a<i;a++){e[a].menuid;var c=e[a].menuname,s=e[a].isvisible,l=e[a].icon;if(s){var d=$("<li></li>").appendTo(".nav"),o=$("<a href='javascript:void(0);'></a>").appendTo(d).data("navData",e[a]).on({click:function(){$("#nav_collapse").triggerHandler("click");var e=$(this).parent().children(".sub-wrap");n&&n[0]!=e[0]&&n.hide(),n=e;var a=this;e.slideToggle((function(){$(".nav").find("a").removeClass("l1nav-select"),$(".nav").find(".level1-tag").removeClass("level1-tag-select"),$(this).is(":visible")&&($(a).addClass("l1nav-select"),$(a).find(".level1-tag").addClass("level1-tag-select"))}))},mouseover:function(e){},mouseout:function(){}});$("<div class='l1icon liicon-"+l+"'></div>").appendTo(o),$("<div class='nav-text'></div>").appendTo(o).html(c),$("<div class='level1-tag'></div>").appendTo(o);var p=$("<div class='sub-wrap'></div>").appendTo(d).css("max-height",t+"px").hide(),r=$("<ul class='sub-ul'></ul>").appendTo(p).css("max-height",t+"px"),v=e[a].subMenuList;if(null==v||null==v)continue;for(var b=0;b<v.length;b++){v[b].menuid;var u=v[b].menuname,m=v[b].isvisible,f=v[b].icon;if(m){var g=$("<li id='nav_"+v[b].menuid+"'></li>").appendTo(r),h=$("<a href='javascript:void(0);'></a>").appendTo(g).data("navData",v[b]);$("<div class='nav-icon nav-icon-"+f+"'></div>").appendTo(h),$("<div class='nav-text'></div>").appendTo(h).html(u),h.on({click:function(){$(".nav").find("li>a").removeClass("nav-select"),$(this).addClass("nav-select");var e=$(this).data("navData");if($(".cluster-tab").children().removeClass("tab-select"),$(".content").css("visibility","hidden"),$.activeTab.indexOf(e.menuid)<0){var a=$("<div id='tab_"+e.menuid+"' class='tab tab-select'>").data("navData",e).appendTo($(".cluster-tab")).on("click",(function(){$(".nav").find("li>a").removeClass("nav-select");var a=$(this).data("navData").menuid;$("#nav_"+a).children("a").addClass("nav-select");var n=$("#nav_"+a).parent().parent();n.is(":visible")||n.prev("a").triggerHandler("click"),$(".cluster-tab").children().removeClass("tab-select"),$(".content").css("visibility","hidden"),$(this).addClass("tab-select"),$("#content_"+e.menuid).css("visibility","visible")}));$("<div class='tabtext'>"+e.menuname+"</div>").appendTo(a),$("<div class='tabclose'>×</div>").appendTo(a).data("tabId",e.menuid).on("click",(function(e){var a=$(this).data("tabId");$("#tab_"+a).remove(),$("#content_"+a).remove();var n=$.activeTab.indexOf(a);$.activeTab.splice(n,1);var i=$(".cluster-tab");if(0==i.find(".tab-select").length&&i.children().length>0){var t=n-1;t<0&&(t=0),$(".cluster-tab").children().eq(t).addClass("tab-select"),$(".cluster-center").children().eq(t+1).css("visibility","visible")}e.stopPropagation()})),$("<div id='content_"+e.menuid+"' class='content'><iframe id='appiframe' name='appiframe' src='"+e.menuurl+"' width='100%' height='100%' scrolling='no' frameborder='0'></iframe></div>").appendTo(".cluster-center"),$.activeTab.push(e.menuid)}else $("#tab_"+e.menuid).addClass("tab-select"),$("#content_"+e.menuid).css("visibility","visible")}})}}}}};var n=null,i=e.length,t=$(".cluster-nav").innerHeight()-48*i;$.activeTab=[],a()}catch{}}),1e3)}}();
